<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Agenda de Alain</title>
  <meta name="theme-color" content="#4a90e2" />
  <link rel="manifest" href="manifest.json" />
  <link rel="icon" href="assets/favicon.png" />
  <style>
    :root { --primary:#4a90e2; --bg:#f9fafc; --ink:#222; --muted:#556; }
    *{ box-sizing:border-box }
    body{ margin:0; font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial,sans-serif; background:var(--bg); color:var(--ink) }
    header{ position:sticky; top:0; z-index:10; background:var(--primary); color:#fff; text-align:center; padding:1rem; font-size:1.15rem; font-weight:700 }
    nav{ display:grid; grid-template-columns: repeat(4,1fr); gap:.5rem; padding:.5rem; background:#eef1f6; position:sticky; top:56px; z-index:9 }
    nav button{ padding:.7rem .5rem; border:none; border-radius:12px; background:var(--primary); color:#fff; font-size:1rem }
    nav button[aria-current="page"]{ outline:2px solid #fff; box-shadow:0 0 0 2px rgba(0,0,0,.08) inset }
    main{ padding:1rem }
    section{ display:none }
    section.active{ display:block }
    h2{ margin:.2rem 0 .8rem; color:var(--primary); font-size:1.1rem; display:flex; align-items:center; justify-content:space-between }
    .card{ background:#fff; border-radius:12px; box-shadow:0 2px 8px rgba(0,0,0,.06); padding:1rem; margin:.6rem 0 }
    .table-wrap{ overflow-x:auto }
    table{ width:100%; border-collapse:collapse; min-width:760px }
    th,td{ border:1px solid #e6e9ef; padding:.6rem .5rem; text-align:left; vertical-align:top }
    th{ background:#f3f6fb; color:#223; font-weight:700 }
    tbody tr:nth-child(even) td{ background:#fbfcfe }
    .hour{ white-space:nowrap; font-weight:600; color:#334 }
    .pill{ display:inline-block; padding:.2rem .5rem; border-radius:999px; background:#eef; font-size:.85rem; margin-left:.4rem }
    .muted{ color:var(--muted); font-size:.9rem }
    .kanban{ display:flex; gap:.75rem; overflow-x:auto; padding-bottom:.5rem }
    .col{ flex:1 0 230px; background:#f1f3f7; border-radius:12px; padding:.5rem }
    .col h3{ margin:.25rem .5rem; font-size:1rem; color:#334; display:flex; align-items:center; justify-content:space-between }
    .note{ background:#fff3cd; padding:.6rem .8rem; border-left:6px solid #ffc107; border-radius:8px; margin:.5rem 0 }
    footer{ padding:1rem; text-align:center; color:#667; font-size:.85rem }

    /* Deberes */
    .toolbar{ display:flex; gap:.5rem; flex-wrap:wrap }
    .toolbar button, .toolbar label.btn{ background:var(--primary); color:#fff; border:none; border-radius:10px; padding:.5rem .75rem; cursor:pointer }
    .toolbar input[type="file"]{ display:none }
    dialog{ width:min(560px,92vw); border:none; border-radius:16px; padding:0; box-shadow:0 12px 40px rgba(0,0,0,.25) }
    .dlg-head{ background:var(--primary); color:#fff; padding:1rem; border-radius:16px 16px 0 0; font-weight:700 }
    .dlg-body{ padding:1rem; display:grid; gap:.75rem }
    .field{ display:grid; gap:.35rem }
    input[type="text"], input[type="date"], select, textarea{ width:100%; padding:.7rem .8rem; border-radius:10px; border:1px solid #d9deea }
    .dlg-actions{ display:flex; justify-content:flex-end; gap:.5rem; padding:1rem }
    .btn{ border:none; border-radius:10px; padding:.6rem .9rem }
    .btn.secondary{ background:#eef1f6; color:#223 }
    .btn.primary{ background:var(--primary); color:#fff }
    .task-row{ display:flex; align-items:center; gap:.6rem }
    .task-row label{ flex:1 }
    .ghost{ opacity:.55 }
    .small{ font-size:.85rem; color:#667 }
    .chip{ display:inline-block; padding:.15rem .45rem; border-radius:999px; background:#e9f1ff; font-size:.78rem; margin-left:.4rem; color:#fff }
    .actions{ display:flex; gap:.4rem }
    .icon-btn{ background:transparent; border:none; padding:.25rem .4rem; cursor:pointer }

    .note-card{ display:flex; gap:.6rem; align-items:flex-start }
    .add-mini{ background:#4a90e2; color:#fff; border:none; border-radius:10px; padding:.3rem .5rem; font-size:.85rem; }
  </style>

  <script>
    /* ---------- Navegaci√≥n SPA ---------- */
    function showSection(id){
      document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      document.querySelectorAll('nav button').forEach(b=>b.removeAttribute('aria-current'));
      document.querySelector(`nav button[data-target="${id}"]`).setAttribute('aria-current','page');
    }

    /* ---------- Deberes (localStorage + colores + export/import) ---------- */
    const STORE_KEY='agenda.deberes.v1';
    function loadTasks(){ try{ return JSON.parse(localStorage.getItem(STORE_KEY))||[] }catch(e){ return [] } }
    function saveTasks(a){ localStorage.setItem(STORE_KEY, JSON.stringify(a)) }

    const SUBJECT_COLORS={
      'mates':'#3b82f6','matematicas':'#3b82f6','matem√°ticas':'#3b82f6',
      'lengua':'#ef4444','castellano':'#ef4444',
      'ingl√©s':'#22c55e','ingles':'#22c55e',
      'euskera':'#06b6d4',
      'tecnologia':'#a855f7','tecnolog√≠a':'#a855f7','tecnologia y digitalizacion':'#a855f7','tecnolog√≠a y digitalizaci√≥n':'#a855f7',
      'fyq':'#f59e0b','fisica y quimica':'#f59e0b','f√≠sica y qu√≠mica':'#f59e0b',
      'plastica':'#ec4899','pl√°stica':'#ec4899',
      'musica':'#10b981','m√∫sica':'#10b981',
      'religion':'#8b5cf6','religi√≥n':'#8b5cf6',
      'tutoria':'#14b8a6','tutor√≠a':'#14b8a6',
      'geografia':'#84cc16','geograf√≠a e historia':'#84cc16','geografia e historia':'#84cc16',
      'salud':'#f97316'
    };
    // FIX universal: quitar tildes sin usar \p{Diacritic}
    function norm(s){
      return (s||'')
        .toLowerCase()
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g,'') // elimina marcas diacr√≠ticas
        .trim();
    }
    function subjectColor(s){
      const n=norm(s);
      if(SUBJECT_COLORS[n]) return SUBJECT_COLORS[n];
      for(const k of Object.keys(SUBJECT_COLORS)) if(n.startsWith(k)) return SUBJECT_COLORS[k];
      const pal=['#0ea5e9','#f43f5e','#22c55e','#eab308','#8b5cf6','#06b6d4','#84cc16','#f97316','#14b8a6'];
      let h=0; for(let i=0;i<n.length;i++){ h=((h<<5)-h)+n.charCodeAt(i); h|=0; }
      return pal[Math.abs(h)%pal.length];
    }

    function rowHTML(t,i){
      const c=t.subject?subjectColor(t.subject):null;
      const chip=t.subject?`<span class="chip" style="background:${c}">${t.subject}</span>`:'';
      const due=t.due?`<span class="pill">${t.due}</span>`:'';
      return `<div class="card task-row${t.done?' ghost':''}">
        <input type="checkbox" class="chk" data-idx="${i}" ${t.done?'checked':''}/>
        <label>${t.text} ${chip} ${due}</label>
        <div class="actions"><button class="icon-btn del" title="Eliminar" data-idx="${i}">üóëÔ∏è</button></div>
      </div>`;
    }
    function renderTasks(){
      const list=document.getElementById('tasksList');
      const arr=loadTasks();
      if(!arr.length){ list.innerHTML='<p class="muted">No hay tareas todav√≠a. Pulsa ‚ûï para a√±adir la primera.</p>'; return; }
      const ordered=[...arr].sort((a,b)=> (a.done===b.done ? (a.due||'').localeCompare(b.due||'') : a.done-b.done));
      list.innerHTML=ordered.map((t,i)=>rowHTML(t,i)).join('');
      list.querySelectorAll('.chk').forEach(chk=>{
        chk.addEventListener('change',e=>{
          const idx=+e.target.dataset.idx; const data=loadTasks(); data[idx].done=e.target.checked; saveTasks(data); renderTasks();
        });
      });
      list.querySelectorAll('.del').forEach(btn=>{
        btn.addEventListener('click',e=>{
          const idx=+e.currentTarget.dataset.idx; const data=loadTasks(); data.splice(idx,1); saveTasks(data); renderTasks();
        });
      });
    }
    function addTaskFromForm(){
      const text=document.getElementById('taskText').value.trim();
      const subject=document.getElementById('taskSubject').value.trim();
      const due=document.getElementById('taskDate').value;
      if(!text){ alert('Escribe la tarea.'); return; }
      const arr=loadTasks(); arr.push({text,subject,due,done:false,created:new Date().toISOString()}); saveTasks(arr);
      document.getElementById('formNew').reset(); document.getElementById('dlgNew').close(); renderTasks();
    }
    function exportTasks(){
      const blob=new Blob([JSON.stringify(loadTasks(),null,2)],{type:'application/json'});
      const a=document.createElement('a'),d=new Date(),pad=n=>String(n).padStart(2,'0');
      a.download=`deberes-alain-${d.getFullYear()}${pad(d.getMonth()+1)}${pad(d.getDate())}.json`;
      a.href=URL.createObjectURL(blob); a.click(); setTimeout(()=>URL.revokeObjectURL(a.href),1000);
    }
    function importTasksFromFile(file){
      if(!file) return;
      const r=new FileReader();
      r.onload=()=>{ try{
        const data=JSON.parse(r.result); if(!Array.isArray(data)) throw new Error();
        const safe=data.map(o=>({text:String(o.text||'').slice(0,500),subject:o.subject?String(o.subject).slice(0,60):'',due:o.due?String(o.due).slice(0,20):'',done:!!o.done,created:o.created||new Date().toISOString()}));
        saveTasks(safe); renderTasks(); alert('Importaci√≥n completada ‚úÖ');
      }catch(e){ alert('El archivo no es v√°lido. Debe ser un JSON exportado.'); }};
      r.readAsText(file);
    }

    /* ---------- Proyectos (kanban simple add/delete) ---------- */
    const PROJ_KEY='agenda.proyectos.v1';
    function loadProjects(){ try{ return JSON.parse(localStorage.getItem(PROJ_KEY)) || {todo:['üìä Trabajo de Ciencias','üé≠ Teatro escolar'], doing:['üìò Proyecto de Historia'], done:['üé® L√°mina de Pl√°stica']}; }catch(e){ return {todo:[],doing:[],done:[]}; } }
    function saveProjects(p){ localStorage.setItem(PROJ_KEY, JSON.stringify(p)); }
    function renderProjects(){
      const p=loadProjects();
      const mk=(arr,zone)=> arr.map((t,i)=>`
        <div class="card">
          <div style="display:flex;justify-content:space-between;align-items:center;gap:.5rem;">
            <span>${t}</span>
            <button class="icon-btn" data-zone="${zone}" data-idx="${i}" title="Eliminar">üóëÔ∏è</button>
          </div>
        </div>`).join('') || '<p class="muted" style="padding:.5rem 0 .2rem .5rem;">Vac√≠o</p>';
      document.getElementById('proj-todo').innerHTML = mk(p.todo,'todo');
      document.getElementById('proj-doing').innerHTML = mk(p.doing,'doing');
      document.getElementById('proj-done').innerHTML = mk(p.done,'done');
      document.querySelectorAll('#proyectos .icon-btn').forEach(btn=>{
        btn.addEventListener('click',e=>{
          const z=e.currentTarget.dataset.zone; const i=+e.currentTarget.dataset.idx;
          const d=loadProjects(); d[z].splice(i,1); saveProjects(d); renderProjects();
        });
      });
    }
    function addProjectInline(zone){
      const text=prompt('Nombre del proyecto:'); if(!text) return;
      const d=loadProjects(); d[zone].push(text.slice(0,120)); saveProjects(d); renderProjects();
    }

    /* ---------- Notas r√°pidas ---------- */
    const NOTES_KEY='agenda.notas.v1';
    function loadNotes(){ try{ return JSON.parse(localStorage.getItem(NOTES_KEY)) || ['‚ûó Examen de mates el viernes','üëü Traer ch√°ndal el lunes','üìò Entregar libro de lectura el martes']; }catch(e){ return []; } }
    function saveNotes(n){ localStorage.setItem(NOTES_KEY, JSON.stringify(n)); }
    function renderNotes(){
      const n=loadNotes(); const wrap=document.getElementById('notesWrap');
      if(!n.length){ wrap.innerHTML='<p class="muted">Sin notas. Pulsa ‚ûï para a√±adir.</p>'; return; }
      wrap.innerHTML=n.map((t,i)=>`
        <div class="note note-card">
          <div style="flex:1">${t}</div>
          <button class="icon-btn" data-idx="${i}" title="Eliminar">üóëÔ∏è</button>
        </div>`).join('');
      wrap.querySelectorAll('.icon-btn').forEach(b=>{
        b.addEventListener('click',e=>{
          const idx=+e.currentTarget.dataset.idx; const d=loadNotes(); d.splice(idx,1); saveNotes(d); renderNotes();
        });
      });
    }
    function addNote(){
      const text=prompt('Escribe la nota:'); if(!text) return;
      const n=loadNotes(); n.push(text.slice(0,240)); saveNotes(n); renderNotes();
    }

    /* ---------- Init ---------- */
    document.addEventListener('DOMContentLoaded', ()=>{
      // SPA nav
      document.querySelectorAll('nav button').forEach(b=> b.addEventListener('click', ()=> showSection(b.dataset.target)));
      showSection('horario');

      // PWA
      if('serviceWorker' in navigator){ navigator.serviceWorker.register('./sw.js').catch(()=>{}); }

      // Deberes
      renderTasks();
      const btnNew=document.getElementById('btnNew');
      if(btnNew){ btnNew.addEventListener('click', ()=> document.getElementById('dlgNew').showModal()); }
      const btnCreate=document.getElementById('btnCreate');
      if(btnCreate){ btnCreate.addEventListener('click', addTaskFromForm); }
      const btnCancel=document.getElementById('btnCancel');
      if(btnCancel){ btnCancel.addEventListener('click', ()=> document.getElementById('dlgNew').close()); }
      const btnExport=document.getElementById('btnExport');
      if(btnExport){ btnExport.addEventListener('click', exportTasks); }
      const fileImport=document.getElementById('fileImport');
      if(fileImport){ fileImport.addEventListener('change', e=> importTasksFromFile(e.target.files[0])); }
      const btnImport=document.getElementById('btnImport');
      if(btnImport){ btnImport.addEventListener('click', ()=> fileImport && fileImport.click()); }

      // Proyectos + Notas
      renderProjects(); renderNotes();
      const btnAddTodo=document.getElementById('btnAddTodo');
      if(btnAddTodo) btnAddTodo.addEventListener('click', ()=> addProjectInline('todo'));
      const btnAddDoing=document.getElementById('btnAddDoing');
      if(btnAddDoing) btnAddDoing.addEventListener('click', ()=> addProjectInline('doing'));
      const btnAddDone=document.getElementById('btnAddDone');
      if(btnAddDone) btnAddDone.addEventListener('click', ()=> addProjectInline('done'));
      const btnAddNote=document.getElementById('btnAddNote');
      if(btnAddNote) btnAddNote.addEventListener('click', addNote);
    });
  </script>
</head>
<body>
  <header>üìö Agenda de Alain</header>

  <nav>
    <button data-target="horario" aria-current="page">üìÖ Horario</button>
    <button data-target="deberes">üìù Deberes</button>
    <button data-target="proyectos">üöÄ Proyectos</button>
    <button data-target="notas">üí¨ Notas</button>
  </nav>

  <main>
    <!-- HORARIO -->
    <section id="horario" class="active">
      <h2>üìÖ Horario Semanal (2¬∫B)</h2>
      <div class="card table-wrap">
        <table>
          <thead>
            <tr>
              <th>Hora</th>
              <th>Lunes</th>
              <th>Martes</th>
              <th>Mi√©rcoles</th>
              <th>Jueves</th>
              <th>Viernes</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="hour">8:30 ‚Äì 9:25</td>
              <td>üèÉ‚Äç‚ôÇÔ∏è Educaci√≥n F√≠sica <span class="muted">(Noelia)</span></td>
              <td>üåê Euskera <span class="muted">(I√±igo)</span></td>
              <td>üèÉ‚Äç‚ôÄÔ∏è Educaci√≥n F√≠sica <span class="muted">(Noelia)</span></td>
              <td>üß† Salud F√≠sica y Emociones <span class="muted">(Noelia/Leire ¬∑ P. Cr√≠tico)</span></td>
              <td>‚úçÔ∏è Lengua <span class="muted">(M¬™ Carmen)</span></td>
            </tr>
            <tr>
              <td class="hour">9:25 ‚Äì 10:20</td>
              <td>üá¨üáß Ingl√©s <span class="muted">(Sheila)</span></td>
              <td>‚öóÔ∏è F√≠sica y Qu√≠mica <span class="muted">(Miriam)</span></td>
              <td>üíª Tecnolog√≠a y Digitalizaci√≥n <span class="muted">(Juanda)</span></td>
              <td>‚ûó Matem√°ticas <span class="muted">(Jos√© Manuel)</span></td>
              <td>üåç Geograf√≠a e Historia <span class="muted">(Leire)</span></td>
            </tr>
            <tr>
              <td class="hour">10:35 ‚Äì 11:30</td>
              <td>‚úçÔ∏è Lengua <span class="muted">(M¬™ Carmen)</span></td>
              <td>üé® Pl√°stica <span class="muted">(Ander)</span></td>
              <td>üåê Euskera <span class="muted">(I√±igo)</span></td>
              <td>‚öóÔ∏è F√≠sica y Qu√≠mica <span class="muted">(Miriam)</span></td>
              <td>‚ûó Matem√°ticas <span class="muted">(Jos√© Manuel)</span></td>
            </tr>
            <tr>
              <td class="hour">11:30 ‚Äì 12:25</td>
              <td>‚ûó Matem√°ticas <span class="muted">(Jos√© Manuel)</span></td>
              <td>üá¨üáß Ingl√©s <span class="muted">(Sheila)</span></td>
              <td>‚ûó Matem√°ticas <span class="muted">(Jos√© Manuel)</span></td>
              <td>‚úùÔ∏è Religi√≥n <span class="muted">(Antzane)</span></td>
              <td>üå± Tutor√≠a <span class="muted">(I√±igo)</span></td>
            </tr>
            <tr>
              <td class="hour">12:40 ‚Äì 13:35</td>
              <td>üß† Salud F√≠sica y Emociones <span class="muted">(Noelia/Leire)</span></td>
              <td>üéµ M√∫sica <span class="muted">(Javier Lekue)</span></td>
              <td>‚úçÔ∏è Lengua <span class="muted">(M¬™ Carmen)</span></td>
              <td>‚úçÔ∏è Lengua <span class="muted">(M¬™ Carmen)</span></td>
              <td>üá¨üáß Ingl√©s <span class="muted">(Sheila)</span></td>
            </tr>
            <tr>
              <td class="hour">13:35 ‚Äì 14:30</td>
              <td>üåç Geograf√≠a e Historia <span class="muted">(Leire)</span></td>
              <td>üíª Tecnolog√≠a y Digitalizaci√≥n <span class="muted">(Juanda)</span></td>
              <td>üá¨üáß Ingl√©s GH <span class="muted">(Sheila)</span></td>
              <td>üåü Valores / Interioridad <span class="muted">(Jos√© Manuel)</span></td>
              <td>üåê Euskera <span class="muted">(I√±igo)</span></td>
            </tr>
          </tbody>
        </table>
        <p class="muted" style="margin-top:.75rem;">*Desliza horizontalmente si no cabe completa en tu m√≥vil.</p>
      </div>
    </section>

    <!-- DEBERES -->
    <section id="deberes">
      <h2>
        <span>üìù Deberes y Ex√°menes</span>
        <span class="toolbar">
          <button id="btnNew" title="A√±adir">‚ûï A√±adir</button>
          <button id="btnExport" title="Exportar">‚¨áÔ∏è Exportar</button>
          <label for="fileImport" class="btn">‚¨ÜÔ∏è Importar</label>
          <input id="fileImport" type="file" accept="application/json,.json" />
        </span>
      </h2>
      <div id="tasksList"></div>

      <dialog id="dlgNew">
        <div class="dlg-head">‚ûï Nueva tarea / examen</div>
        <form id="formNew" class="dlg-body" method="dialog">
          <div class="field">
            <label for="taskText">Tarea *</label>
            <input id="taskText" type="text" placeholder="Ej.: Ejercicios tema 3" required />
          </div>
          <div class="field">
            <label for="taskSubject">Asignatura (opcional)</label>
            <input id="taskSubject" type="text" placeholder="Mates, Lengua, Ingl√©s‚Ä¶" />
          </div>
          <div class="field">
            <label for="taskDate">Fecha l√≠mite</label>
            <input id="taskDate" type="date" />
          </div>
        </form>
        <div class="dlg-actions">
          <button class="btn secondary" id="btnCancel">Cancelar</button>
          <button class="btn primary" id="btnCreate">Crear</button>
        </div>
      </dialog>
      <p class="small">Consejo: usa siempre el mismo nombre de asignatura para mantener el mismo color (p. ej., ‚ÄúMates‚Äù, ‚ÄúLengua‚Äù, ‚ÄúIngl√©s‚Äù).</p>
    </section>

    <!-- PROYECTOS -->
    <section id="proyectos">
      <h2>üöÄ Proyectos</h2>
      <div class="kanban">
        <div class="col">
          <h3>Pendiente <button id="btnAddTodo" class="add-mini">‚ûï</button></h3>
          <div id="proj-todo"></div>
        </div>
        <div class="col">
          <h3>En curso <button id="btnAddDoing" class="add-mini">‚ûï</button></h3>
          <div id="proj-doing"></div>
        </div>
        <div class="col">
          <h3>Terminado <button id="btnAddDone" class="add-mini">‚ûï</button></h3>
          <div id="proj-done"></div>
        </div>
      </div>
      <p class="small">Pulsa ‚ûï en cada columna para a√±adir. Toca üóëÔ∏è para eliminar.</p>
    </section>

    <!-- NOTAS -->
    <section id="notas">
      <h2>üí¨ Notas r√°pidas <button id="btnAddNote" class="add-mini">‚ûï</button></h2>
      <div id="notesWrap"></div>
    </section>
  </main>

  <footer>GarreTT üíô</footer>
</body>
</html>
